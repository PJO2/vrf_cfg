! --------------------------------------------- 
! CE to PE peering
! Constructor
! ---------------------------------------------




route-map SETCT88
  set community 65000:88
exit
! --------------------------------------------- 
! CE to PE peering
! extra points on site.vars.wan[?name==role]
! ---------------------------------------------

! called with extra: {'name': 'primary', 'ip': '11.11.0.1'}

router bgp 65000
  neighbor 11.11.0.1 remote-as 25186
  neighbor 11.11.0.1 description -- primary peer to PE--
  neighbor 11.11.0.1 timers 15 45
  
  address-family ipv4
  neighbor 11.11.0.1 activate
  neighbor 11.11.0.1 route-map SETCT77 out
  exit-address-family

exit

! --------------------------------------------- 
! CE to RS peering
! ---------------------------------------------



interface Loopback 100 
  description -- BGP to RS peering --
  ip address 172.20.1.1 255.255.255.255

router bgp 65000

  address-family ipv4
  ! advertise the Loopback to the underlay
  network 172.20.1.1 mask 255.255.255.255
 exit-address-family


   neighbor 172.20.0.254 remote-as 4200999000
   neighbor 172.20.0.254 description -- To route-server RS1 --
   neighbor 172.20.0.254 ebgp-multihop 255
   neighbor 172.20.0.254 update-source Loopback100
 address-family vpnv4
  neighbor 172.20.0.254 activate
  neighbor 172.20.0.254 send-community both
  neighbor 172.20.0.254 inter-as-hybrid
 exit-address-family

   neighbor 172.20.1.254 remote-as 4200999000
   neighbor 172.20.1.254 description -- To route-server RS2 --
   neighbor 172.20.1.254 ebgp-multihop 255
   neighbor 172.20.1.254 update-source Loopback100
 address-family vpnv4
  neighbor 172.20.1.254 activate
  neighbor 172.20.1.254 send-community both
  neighbor 172.20.1.254 inter-as-hybrid
 exit-address-family


exit
! B2B template for dual1 routers

! --------------------------------------------- 
! Per VRF configuration constructor
! ---------------------------------------------

ip prefix-list DENY_ALL seq 5 deny 0.0.0.0/0 le 32

iteration  1
with item  {'name': 'Video', 'lan': {'ip': '101.2.3.4'}}
with extra {'name': 'Video', 'id': 41, 'type': 'Hub and Spoke'}
iteration  2
with item  {'name': 'Phone', 'lan': {'ip': '101.4.5.6'}}
with extra {'name': 'Phone', 'id': 46, 'type': 'Any to Any'}

banner exec "router by Orange"
author is : PJO2
