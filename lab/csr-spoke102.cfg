
!
! Last configuration change at 14:30:11 UTC Thu Apr 29 2021 by cisco
!
version 16.9
service timestamps debug datetime msec
service timestamps log datetime msec
platform qfp utilization monitor load 80
no platform punt-keepalive disable-kernel-core
platform console auto
!
hostname csr-spoke02
!
boot-start-marker
boot system bootflash:csr1000v-universalk9.16.09.05.SPA.bin
boot-end-marker
!
!
vrf definition Contrat001
 rd 4200999001:2
 route-target export 4200999001:2
 route-target export 65000:1
 route-target import 65000:1
 !
 address-family ipv4
  inter-as-hybrid next-hop 10.0.12.1
 exit-address-family
!
vrf definition Contrat002
 rd 4200999002:2
 route-target export 4200999001:2
 route-target export 65000:2
 route-target import 65000:2
 !
 address-family ipv4
  inter-as-hybrid next-hop 10.0.22.1
 exit-address-family
!
!
aaa new-model
!
!
aaa authentication login default local
aaa authorization exec default local if-authenticated 
aaa authorization network default local 
!
!
!
!
!
aaa session-id common
!
!
!
!
!
!
!
no ip domain lookup
ip domain name local
!
!
!
login on-success log
!
!
!
!
!
!
!
subscriber templating
! 
! 
! 
! 
multilink bundle-name authenticated
!
!
!
!
!
crypto pki trustpoint TP-self-signed-554278174
 enrollment selfsigned
 subject-name cn=IOS-Self-Signed-Certificate-554278174
 revocation-check none
 rsakeypair TP-self-signed-554278174
!
!
crypto pki certificate chain TP-self-signed-554278174
!
!
!
!
!
!
!
!
license udi pid CSR1000V sn 9PB2A8ZB31K
license accept end user agreement
license boot level appx
no license smart enable
diagnostic bootup level minimal
!
spanning-tree extend system-id
!
netconf-yang
!
!
username cisco privilege 15 secret 5 $1$GC0J$xWJocjpBDz2GfyNQKuJ.f/
!
redundancy
!
!
!
!
!
!
! 
! 
!
!
interface Loopback100
 description -- CE to SR peering --
 ip address 172.20.0.102 255.255.255.255
!
interface GigabitEthernet1
 description -- Administration Radequa --
 ip address 10.112.83.102 255.255.255.0
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet2
 description -- Trunk to Customer LAN --
 no ip address
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet2.1012
 encapsulation dot1Q 1012
 vrf forwarding Contrat001
 ip address 192.168.112.1 255.255.255.0
!
interface GigabitEthernet2.1022
 encapsulation dot1Q 1022
 vrf forwarding Contrat002
 ip address 192.168.122.1 255.255.255.0
!
interface GigabitEthernet3
 description -- Trunk to WAN --
 no ip address
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet3.2432
 description -- CPE GRT to WAN, no VRF awareness --
 encapsulation dot1Q 2432
 ip address 10.24.32.2 255.255.255.252
!
interface vasileft1
 description -- VRF Contrat001 to GRT gateway --
 vrf forwarding Contrat001
 ip address 10.0.12.2 255.255.255.252
 no keepalive
!
interface vasileft2
 description -- VRF Contrat002 to GRT gateway --
 vrf forwarding Contrat002
 ip address 10.0.22.2 255.255.255.252
 no keepalive
!
interface vasiright1
 description -- GRT to VRF Contrat001 gateway --
 ip address 10.0.12.1 255.255.255.252
 no keepalive
!
interface vasiright2
 description -- GRT to VRF Contrat002 gateway --
 ip address 10.0.22.1 255.255.255.252
 no keepalive
!
router bgp 4200999002
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 neighbor 10.0.12.2 remote-as 4200999002
 neighbor 10.0.12.2 description --Vasi1--
 neighbor 10.0.22.2 remote-as 4200999002
 neighbor 10.0.22.2 description --Vasi2--
 neighbor 10.24.32.1 remote-as 25186
 neighbor 10.24.32.1 description --PE--
 neighbor 172.20.0.100 remote-as 4200999000
 neighbor 172.20.0.100 local-as 4200999999 no-prepend
 neighbor 172.20.0.100 description --interAS-AB-peer--
 neighbor 172.20.0.100 ebgp-multihop 255
 neighbor 172.20.0.100 update-source Loopback100
 !
 address-family ipv4
  network 172.20.0.102 mask 255.255.255.255
  neighbor 10.0.12.2 activate
  neighbor 10.0.22.2 activate
  neighbor 10.24.32.1 activate
  neighbor 10.24.32.1 advertisement-interval 5
 exit-address-family
 !
 address-family vpnv4
  neighbor 172.20.0.100 activate
  neighbor 172.20.0.100 send-community both
  neighbor 172.20.0.100 allowas-in 1
  neighbor 172.20.0.100 inter-as-hybrid
 exit-address-family
 !
 address-family ipv4 vrf Contrat001
  bgp router-id 10.0.12.2
  network 192.168.112.0
  neighbor 10.0.12.1 remote-as 4200999002
  neighbor 10.0.12.1 activate
 exit-address-family
 !
 address-family ipv4 vrf Contrat002
  bgp router-id 10.0.22.2
  network 192.168.122.0
  neighbor 10.0.22.1 remote-as 4200999002
  neighbor 10.0.22.1 activate
 exit-address-family
!
!
virtual-service csr_mgmt
 ip shared host-interface GigabitEthernet1
 activate
!
ip forward-protocol nd
ip http server
ip http authentication local
ip http secure-server
ip route 193.105.90.0 255.255.255.0 10.112.83.126
!
ip as-path access-list 42 permit ^$
ip as-path access-list 49 permit ^$
ip ssh port 2022 rotary 22
ip scp server enable
!
!
ip prefix-list DENY seq 5 deny 0.0.0.0/0 le 32
!
ip prefix-list PEERs seq 5 permit 172.20.0.0/24 le 32
!
!
route-map SetNextHop permit 10 
 set ip next-hop 10.24.32.1
!
!
!
!
!
control-plane
!
!
!
!
!
!
line con 0
 stopbits 1
line vty 0 4
 exec-timeout 120 0
line vty 5 15
 exec-timeout 120 0
line vty 16 99
line vty 100 105
 rotary 22
!
netconf ssh
!
!
!
!
!
end
