
!
! Last configuration change at 09:24:41 UTC Mon May 10 2021 by cisco
!
version 16.9
service timestamps debug datetime msec
service timestamps log datetime msec
platform qfp utilization monitor load 80
no platform punt-keepalive disable-kernel-core
platform console auto
!
hostname csr-spoke01
!
boot-start-marker
boot system bootflash:csr1000v-universalk9.16.09.05.SPA.bin
boot-end-marker
!
!
vrf definition Data1
 rd 65000:1019031
 route-target export 31:101
 route-target import 31:101
 !
 address-family ipv4
  inter-as-hybrid next-hop 10.0.31.0
 exit-address-family
!
vrf definition Phone
 rd 65000:1019046
 route-target export 46:101
 route-target import 46:101
 !
 address-family ipv4
  inter-as-hybrid next-hop 10.0.46.0
 exit-address-family
!
vrf definition Video
 rd 65000:1019041
 route-target export 41:101
 route-target import 41:101
 !
 address-family ipv4
  inter-as-hybrid next-hop 10.0.41.0
 exit-address-family
!
!
aaa new-model
!
!
aaa authentication login default local
aaa authorization exec default local if-authenticated 
aaa authorization network default local 
aaa authorization network LOCAL_AAA local 
!
!
!
!
!
aaa session-id common
!
!
!
!
!
!
!
no ip domain lookup
ip domain name local
!
!
!
login on-success log
!
!
!
!
!
!
!
subscriber templating
! 
! 
! 
! 
mpls label range 10100 10199
multilink bundle-name authenticated
!
!
!
!
!
crypto pki trustpoint TP-self-signed-3733380347
 enrollment selfsigned
 subject-name cn=IOS-Self-Signed-Certificate-3733380347
 revocation-check none
 rsakeypair TP-self-signed-3733380347
!
!
crypto pki certificate chain TP-self-signed-3733380347
 certificate self-signed 01
  30820330 30820218 A0030201 02020101 300D0609 2A864886 F70D0101 05050030 
  31312F30 2D060355 04031326 494F532D 53656C66 2D536967 6E65642D 43657274 
  69666963 6174652D 33373333 33383033 3437301E 170D3231 30343239 31353236 
  30395A17 0D333030 31303130 30303030 305A3031 312F302D 06035504 03132649 
  4F532D53 656C662D 5369676E 65642D43 65727469 66696361 74652D33 37333333 
  38303334 37308201 22300D06 092A8648 86F70D01 01010500 0382010F 00308201 
  0A028201 0100AB55 0C92E57F 483673BF 13FFADBD 092CAD06 A8095532 1B5B9B76 
  CB95F867 0E976C67 4CDD2611 56C12615 1858DB8A D32969A1 F0996780 B865300A 
  14A81D11 9BDD8EDA 7A881240 DCCBE71F 757CA82D A7C5CD24 C445A0F9 D56AE2CE 
  191708FA 5BD95A1A 040153F8 CE096FCB E7009CF7 F9773930 2B3095BE 2A7F0BD4 
  D6C66919 3EE98737 0E5C5908 1E7CF90E E1309B80 0399D6E9 4B84F338 B043E144 
  D965C22C 8FCB037B 74074E0C 822D38E8 C0CF0C2D 98AE6E23 4E754745 196B0553 
  CB314DB5 61F8CDE3 8F676FCC F3AC9906 AFA723B5 88A72004 031FBC34 AD5BF1F0 
  65CBB8F1 8A967650 7703DAC9 535CBC53 E3E67224 9D3940B8 A1EE9250 A259C08D 
  35FF68D2 B6C70203 010001A3 53305130 0F060355 1D130101 FF040530 030101FF 
  301F0603 551D2304 18301680 1497F2EA 1AFD28D3 FE01B626 4CA54726 468CAE93 
  80301D06 03551D0E 04160414 97F2EA1A FD28D3FE 01B6264C A5472646 8CAE9380 
  300D0609 2A864886 F70D0101 05050003 82010100 49E38941 725051E5 FEA4C3E5 
  91A07816 98CFECD7 F1E8FEFF 733D747C 2E6E9277 923CC752 B4B7DB6D 6606625F 
  221877E5 13358D0F FF09333F 6E84CC48 9A419A96 A0A56D35 3A2F23B9 74D9B825 
  B58445A7 50A7DB30 E7DC6CC9 DB151727 CB1326E0 BFC90BB7 6CF5DDD9 895E246F 
  F3966C27 121C9285 CE4178BE 22DF7C23 FDF504CE 12B0E52F 78395279 AE78F7ED 
  5B4F4D20 33757419 CA9A374E 283A5570 780EAE98 327CB807 818E3252 2FD42CF4 
  52BA74BE B06A979E 116917EC CE76F393 8F12DB6F CD1812B7 88C06BDE FE3016F7 
  CAED787D 5FAC13F8 D97FAA8F 8C446FF8 F16D3346 A7F96D50 85EC09B0 CAF75F4C 
  0E8855CC CEE0767D 4A5D648C 76E199FF E35E93B1
  	quit
!
!
!
!
!
!
!
!
license udi pid CSR1000V sn 9ADANHEQZGV
license accept end user agreement
license boot level appx
no license smart enable
diagnostic bootup level minimal
!
spanning-tree extend system-id
!
netconf-yang
!
!
username cisco privilege 15 secret 5 $1$GC0J$xWJocjpBDz2GfyNQKuJ.f/
!
redundancy
!
!
!
!
!
!
! 
! 
!
!
interface Loopback100
 description -- BGP to RS peering --
 ip address 172.20.1.101 255.255.255.255
!
interface GigabitEthernet1
 description -- Administration Radequa --
 ip address 10.112.83.101 255.255.255.0
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet2
 description -- Trunk to Customer LAN --
 no ip address
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet2.101
 description -- LAN interface VRF 101 --
 encapsulation dot1Q 101
 ip dhcp client hostname csr-spoke01-vrf-101
 ip address dhcp
!
interface GigabitEthernet2.1011
 encapsulation dot1Q 1011
!
interface GigabitEthernet2.1021
 encapsulation dot1Q 1021
!
interface GigabitEthernet3
 description -- Trunk to WAN --
 no ip address
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet3.31
 description -- LAN interface for VRF Data1
 encapsulation dot1Q 31
 vrf forwarding Data1
 ip address 10.101.31.1 255.255.255.0
!
interface GigabitEthernet3.41
 description -- LAN interface for VRF Video
 encapsulation dot1Q 41
 vrf forwarding Video
 ip address 10.101.41.1 255.255.255.0
!
interface GigabitEthernet3.46
 description -- LAN interface for VRF Phone
 encapsulation dot1Q 46
 vrf forwarding Phone
 ip address 10.101.46.1 255.255.255.0
!
interface GigabitEthernet3.2431
 description -- CPE GRT to WAN, no VRF awareness --
 encapsulation dot1Q 2431
 ip address 10.24.31.2 255.255.255.252
!
interface vasileft31
 description -- dataplane and controlplane leaking from VRF to GRT --
 vrf forwarding Data1
 ip address 10.0.31.1 255.255.255.254
!
interface vasileft41
 description -- dataplane and controlplane leaking from VRF to GRT --
 vrf forwarding Video
 ip address 10.0.41.1 255.255.255.254
!
interface vasileft46
 description -- dataplane and controlplane leaking from VRF to GRT --
 vrf forwarding Phone
 ip address 10.0.46.1 255.255.255.254
!
interface vasiright31
 description -- dataplane and controlplane leaking from GRT to VRF Data1 --
 ip address 10.0.31.0 255.255.255.254
 no keepalive
!
interface vasiright41
 description -- dataplane and controlplane leaking from GRT to VRF Video --
 ip address 10.0.41.0 255.255.255.254
 no keepalive
!
interface vasiright46
 description -- dataplane and controlplane leaking from GRT to VRF Phone --
 ip address 10.0.46.0 255.255.255.254
 no keepalive
!
interface vasiright101
 description -- site 1 -- -- gateway from VRF 101 to GRT --
 ip address 10.0.101.0 255.255.255.254
 no keepalive
!
router bgp 65000
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 neighbor RS peer-group
 neighbor RS remote-as 65500
 neighbor RS description -- To route-server --
 neighbor RS ebgp-multihop 255
 neighbor RS update-source Loopback100
 neighbor RS timers 15 45
 neighbor VASI peer-group
 neighbor VASI remote-as 65000
 neighbor VASI description -- internal peer on VASI --
 neighbor 10.0.31.1 peer-group VASI
 neighbor 10.0.41.1 peer-group VASI
 neighbor 10.0.46.1 peer-group VASI
 neighbor 10.24.31.1 remote-as 25186
 neighbor 10.24.31.1 description -- primary peer to PE--
 neighbor 10.24.31.1 timers 15 45
 neighbor 172.20.0.0 peer-group RS
 neighbor 172.20.0.0 description -- To route-server RS1 --
 neighbor 172.20.0.1 peer-group RS
 neighbor 172.20.0.1 description -- To route-server RS2 --
 !
 address-family ipv4
  network 172.20.1.101 mask 255.255.255.255
  neighbor VASI send-community
  neighbor VASI prefix-list DENY_ALL out
  neighbor 10.0.31.1 activate
  neighbor 10.0.41.1 activate
  neighbor 10.0.46.1 activate
  neighbor 10.24.31.1 activate
  neighbor 10.24.31.1 route-map SETCT77 out
 exit-address-family
 !
 address-family vpnv4
  neighbor RS send-community both
  neighbor RS allowas-in
  neighbor RS soo 65000:101
  neighbor RS inter-as-hybrid
  neighbor 172.20.0.0 activate
  neighbor 172.20.0.1 activate
 exit-address-family
 !
 address-family ipv4 vrf Data1
  bgp router-id 10.0.31.1
  network 10.101.31.0 mask 255.255.255.0
  neighbor 10.0.31.0 remote-as 65000
  neighbor 10.0.31.0 activate
 exit-address-family
 !
 address-family ipv4 vrf Phone
  bgp router-id 10.0.46.1
  network 10.101.46.0 mask 255.255.255.0
  neighbor 10.0.46.0 remote-as 65000
  neighbor 10.0.46.0 activate
 exit-address-family
 !
 address-family ipv4 vrf Video
  bgp router-id 10.0.41.1
  network 10.101.41.0 mask 255.255.255.0
  neighbor 10.0.41.0 remote-as 65000
  neighbor 10.0.41.0 activate
 exit-address-family
!
!
virtual-service csr_mgmt
 ip shared host-interface GigabitEthernet1
 activate
!
ip forward-protocol nd
ip http server
ip http authentication local
ip http secure-server
ip route 193.105.90.0 255.255.255.0 10.112.83.126 name --admin--
!
ip as-path access-list 42 permit ^$
ip scp server enable
!
!
ip prefix-list DENY seq 5 deny 0.0.0.0/0 le 32
!
ip prefix-list DENY_ALL seq 5 deny 0.0.0.0/0 le 32
!
ip prefix-list PEERs seq 5 permit 172.20.0.0/24 le 32
!
!
route-map SETCT77 permit 10 
 set community 4259840077
!
!
!
!
!
control-plane
!
!
!
!
!
banner exec router by Orange
!
line con 0
 stopbits 1
line vty 0 4
 exec-timeout 120 0
line vty 5 15
 exec-timeout 120 0
!
netconf ssh
!
!
!
!
!
end
