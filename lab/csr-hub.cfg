
!
! Last configuration change at 13:41:13 UTC Mon May 10 2021 by cisco
!
version 16.9
service timestamps debug datetime msec
service timestamps log datetime msec
platform qfp utilization monitor load 80
no platform punt-keepalive disable-kernel-core
platform console auto
!
hostname csr-hub
!
boot-start-marker
boot system bootflash:csr1000v-universalk9.16.09.05.SPA.bin
boot-end-marker
!
!
vrf definition Data1
 rd 65000:900031
 route-target import 65000:31
 !
 address-family ipv4
 exit-address-family
!
vrf definition Phone
 rd 65000:900046
 route-target import 65000:46
 !
 address-family ipv4
 exit-address-family
!
vrf definition Video
 rd 65000:900041
 route-target import 65000:41
 !
 address-family ipv4
 exit-address-family
!
!
aaa new-model
!
!
aaa authentication login default local
aaa authorization exec default local if-authenticated 
!
!
!
!
!
aaa session-id common
aaa policy interface-config allow-subinterface
!
!
!
!
!
!
!
no ip domain lookup
ip domain name local
!
!
!
login on-success log
!
!
!
!
!
!
!
subscriber templating
! 
! 
! 
! 
multilink bundle-name authenticated
!
!
!
!
!
crypto pki trustpoint TP-self-signed-3222202584
 enrollment selfsigned
 subject-name cn=IOS-Self-Signed-Certificate-3222202584
 revocation-check none
 rsakeypair TP-self-signed-3222202584
!
!
crypto pki certificate chain TP-self-signed-3222202584
!
!
!
!
!
!
!
!
license udi pid CSR1000V sn 9A3OQ3NU20R
license accept end user agreement
license boot level appx
no license smart enable
diagnostic bootup level minimal
!
spanning-tree extend system-id
!
netconf-yang
!
!
username cisco privilege 15 secret 5 $1$GC0J$xWJocjpBDz2GfyNQKuJ.f/
!
redundancy
!
!
!
!
!
!
! 
! 
!
!
interface Loopback100
 description -- SR to CEs peering --
 ip address 172.20.0.0 255.255.255.255
!
interface GigabitEthernet1
 description -- Administration Radequa --
 ip address 10.112.83.100 255.255.255.0
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet2
 no ip address
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet3
 description -- Trunk to WAN --
 no ip address
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet3.1663
 description -- OOB addmin --
 encapsulation dot1Q 1663
 ip address 172.16.63.100 255.255.255.0
!
interface GigabitEthernet3.2430
 description -- CPE GRT to WAN, no VRF awareness --
 encapsulation dot1Q 2430
 ip address 10.24.30.2 255.255.255.252
!
router bgp 65500
 template peer-policy CEs
  send-community both
 exit-peer-policy
 !
 template peer-session CEs
  remote-as 65000
  ebgp-multihop 255
  update-source Loopback100
  timers 30 90
 exit-peer-session
 !
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 no bgp default route-target filter
 neighbor PE peer-group
 neighbor PE remote-as 25186
 neighbor PE description -- underlay --
 neighbor 10.24.30.1 peer-group PE
 neighbor 172.20.1.101 inherit peer-session CEs
 neighbor 172.20.1.109 inherit peer-session CEs
 neighbor 172.20.2.109 inherit peer-session CEs
 !
 address-family ipv4
  network 172.20.0.0 mask 255.255.255.255
  neighbor PE prefix-list PEERs in
  neighbor PE prefix-list PEERs out
  neighbor 10.24.30.1 activate
 exit-address-family
 !
 address-family vpnv4
  neighbor 172.20.1.101 activate
  neighbor 172.20.1.101 send-community extended
  neighbor 172.20.1.101 inherit peer-policy CEs
  neighbor 172.20.1.101 route-map From_Site_101 in
  neighbor 172.20.1.101 route-map To_Site_101 out
  neighbor 172.20.2.109 activate
  neighbor 172.20.2.109 send-community extended
  neighbor 172.20.2.109 inherit peer-policy CEs
  neighbor 172.20.2.109 route-map From_Site_109 in
  neighbor 172.20.2.109 route-map To_Site_109 out
 exit-address-family
!
!
virtual-service csr_mgmt
 ip shared host-interface GigabitEthernet1
 activate
!
ip forward-protocol nd
ip http server
ip http authentication local
ip http secure-server
ip route 193.105.90.0 255.255.255.0 10.112.83.126
!
ip extcommunity-list standard Contract_555 permit rt 65500:555
ip extcommunity-list standard Contract_666 permit rt 65500:666
ip extcommunity-list expanded vrf_Data1 permit RT:31:.*_
ip extcommunity-list expanded vrf_Phone permit RT:46:.*_
ip extcommunity-list expanded vrf_Video permit RT:41:.*_
ip bgp-community new-format
ip scp server enable
!
!
ip prefix-list DENY seq 5 deny 0.0.0.0/0 le 32
!
ip prefix-list PEERs seq 5 permit 172.20.0.0/20 le 32
!
!
route-map To_Site_101 permit 10 
 description -- Site is Limoges001 --
 match extcommunity Contract_555
!
route-map From_Site_109 permit 31 
 description -- Site is Nantes099 vrf Data1 --
 match extcommunity vrf_Data1
 set extcommunity rt 65000:31 65500:555 additive
!
route-map From_Site_109 permit 41 
 match extcommunity vrf_Video
 set extcommunity rt 65000:41 65500:555 additive
!
route-map From_Site_109 permit 46 
 match extcommunity vrf_Phone
 set extcommunity rt 65000:46 65500:555 additive
!
route-map To_Site_109 permit 10 
 description -- Site is Nantes099 --
 match extcommunity Contract_555
!
route-map From_Site_101 permit 31 
 description -- Site is Limoges001 vrf Data1 --
 match extcommunity vrf_Data1
 set extcommunity rt 65000:31 65500:555 additive
!
route-map From_Site_101 permit 41 
 match extcommunity vrf_Video
 set extcommunity rt 65000:41 65500:555 additive
!
route-map From_Site_101 permit 46 
 match extcommunity vrf_Phone
 set extcommunity rt 65000:46 65500:555 additive
!
!
!
!
!
control-plane
!
!
!
!
!
!
line con 0
 stopbits 1
line vty 0 4
 exec-timeout 120 0
 width 512
 escape-character 5
line vty 5 15
 exec-timeout 120 0
 escape-character 5
!
netconf ssh
!
!
!
!
!
end
