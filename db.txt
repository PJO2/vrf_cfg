
templates:
   - name: Route Server Peering
     file: RS_peering.j2
     services: ['Create', 'Update' ]

   - name: PE CE peering
     file:   L3VPN-peering.j2
     services: ['Create', 'Update' ]
     prolog: L3VPN-peering.ctor.j2
     with_items: device.site.vars.wans | json_query('[? name==`' + device.role.vars.description + '`]')

   - name: mono VRF routing
     file:   perVRF-routing.j2
     prolog: perVRF-routing.ctor.j2
     with_items: device.tenant.vars.vrfs
     services: ['Create', 'Update' ]

   - name: Back to back BGP configuration Primary
     file: B2B-dual1.j2
     services: ['Create', 'Update' ]
   - name: Back to back BGP configuration Secondary
     file: B2B-dual2.j2
     services: ['Create', 'Update' ]

   - name: Banner configuration
     file:  orange.j2
     services: ['Create', 'Update' ]
     vars: 
           author: PJO2


tenants:
   - name: SAUR
     templates:
      - name: Banner configuration
     vars:
        route_servers:
          - name: RS1
            ip:   172.20.0.254
            as:   4200999000
          - name: RS2
            ip:   172.20.1.254
            as:   4200999000
        vrfs:
          - name: Video
            id:  50
            type: Hub and Spoke
          - name: Phone
            id:  51
            type: Any to Any

topologies: 
  - name: L3VPN dual
    templates:
       - name: Route Server Peering
       - name: PE CE peering
       - name: mono VRF routing
    vars: 
    roles:
      - name: dual1
        occurrence: 1
        description: primary router for L3VPN sites
        templates:
          - name: Back to back BGP configuration Primary
        vars:
            description: primary
            role_id:     1 
      - name: dual2
        occurrence: 1
        description: secondary router for L3VPN sites
        templates:
            - name: Back to back BGP configuration Secondary
        vars:
            description: secondary
            role_id:     2 

sites:
   - name: Limoges001
     tenant: SAUR
     location: 
     id:   1001
     contrat: Limoges
     topology: L3VPN dual
     vars:
         vrfs:
           - name: Video
             lan:  
               ip: 101.2.3.4 
           - name: Phone
             lan:  
               ip: 101.4.5.6
         wans:
           - name: primary
             ip:   11.11.0.1
           - name: secondary
             ip:   22.22.0.1
   - name: Nantes099
     tenant: SAUR
     location: 
     id:   1099
     contrat: Nantes
     topology: L3VPN dual
     vars:
         vrfs:
           - name: Video
             lan:  
               ip: 102.2.3.4 
           - name: Internet
             lan:  
               ip: 2.8.76.54
           - name: Phone
             lan:  
               ip: 102.4.5.6

contrats:
   - name: Nantes
     vars: 
            id:   555
   - name: Limoges
     vars:
            id:   666
   
